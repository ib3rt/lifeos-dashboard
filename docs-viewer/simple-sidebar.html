<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docs Viewer - Simple</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            display: flex; 
            height: 100vh; 
            background: #0a0a0f; 
            color: #e0e0e0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        /* LEFT SIDEBAR - MUST BE VISIBLE */
        #sidebar {
            width: 300px;
            min-width: 300px;
            background: #16161e;
            border-right: 1px solid #2a2a3a;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #2a2a3a;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sidebar-header h2 {
            font-size: 16px;
            font-weight: 600;
            color: #00d4ff;
        }
        
        .search-box {
            padding: 15px 20px;
            border-bottom: 1px solid #2a2a3a;
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 15px;
            background: #1a1a24;
            border: 1px solid #2a2a3a;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 14px;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #00d4ff;
        }
        
        .file-tree {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }
        
        .tree-item {
            padding: 10px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            transition: background 0.15s;
        }
        
        .tree-item:hover {
            background: #1f1f2e;
        }
        
        .tree-item.folder {
            font-weight: 600;
            color: #00d4ff;
        }
        
        .tree-item.file {
            color: #e0e0e0;
            padding-left: 35px;
        }
        
        .recent-section {
            padding: 15px 20px;
            border-top: 1px solid #2a2a3a;
            background: #12121a;
        }
        
        .recent-title {
            font-size: 12px;
            font-weight: 600;
            color: #888;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        /* MAIN CONTENT */
        #main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .toolbar {
            padding: 15px 30px;
            border-bottom: 1px solid #2a2a3a;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #0a0a0f;
        }
        
        .breadcrumbs {
            font-size: 14px;
            color: #888;
        }
        
        .theme-btn {
            padding: 8px 16px;
            background: #1a1a24;
            border: 1px solid #2a2a3a;
            border-radius: 8px;
            color: #e0e0e0;
            cursor: pointer;
        }
        
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            max-width: 900px;
            margin: 0 auto;
        }
        
        .welcome {
            text-align: center;
            padding: 60px 0;
        }
        
        .welcome h1 {
            font-size: 32px;
            margin-bottom: 20px;
            color: #00d4ff;
        }
        
        .welcome p {
            color: #888;
            line-height: 1.6;
        }
        
        /* Loading */
        .loading {
            padding: 40px;
            text-align: center;
            color: #888;
        }
        
        /* Document styles */
        .document {
            line-height: 1.8;
        }
        
        .document h1 { font-size: 28px; color: #00d4ff; margin: 24px 0 16px; }
        .document h2 { font-size: 22px; color: #fff; margin: 20px 0 12px; }
        .document h3 { font-size: 18px; color: #ccc; margin: 16px 0 10px; }
        .document p { margin: 12px 0; color: #bbb; }
        .document code { background: #1a1a24; padding: 2px 6px; border-radius: 4px; font-family: 'Monaco', monospace; font-size: 13px; }
        .document pre { background: #1a1a24; padding: 20px; border-radius: 8px; overflow-x: auto; margin: 16px 0; }
        .document pre code { background: none; padding: 0; }
        .document ul, .document ol { margin: 12px 0; padding-left: 24px; }
        .document li { margin: 6px 0; color: #bbb; }
        .document blockquote { border-left: 3px solid #00d4ff; padding-left: 16px; margin: 16px 0; color: #888; }
        .document table { width: 100%; border-collapse: collapse; margin: 16px 0; }
        .document th, .document td { border: 1px solid #2a2a3a; padding: 10px; text-align: left; }
        .document th { background: #1a1a24; color: #00d4ff; }
        .document a { color: #00d4ff; text-decoration: none; }
        .document a:hover { text-decoration: underline; }
        .document hr { border: none; border-top: 1px solid #2a2a3a; margin: 24px 0; }
        .document img { max-width: 100%; border-radius: 8px; }
    </style>
</head>
<body>
    <!-- LEFT SIDEBAR -->
    <aside id="sidebar">
        <div class="sidebar-header">
            <span style="font-size: 24px;">üìö</span>
            <h2>Life OS Docs</h2>
        </div>
        
        <div class="search-box">
            <input type="text" id="search" placeholder="üîç Search files... (‚åòK)">
        </div>
        
        <div class="file-tree" id="fileTree">
            <div class="loading">Loading files...</div>
        </div>
        
        <div class="recent-section">
            <div class="recent-title">üïê Recent Files</div>
            <div id="recentList">
                <div style="color: #666; font-size: 13px;">No recent files</div>
            </div>
        </div>
    </aside>
    
    <!-- MAIN CONTENT -->
    <main id="main">
        <div class="toolbar">
            <div class="breadcrumbs" id="breadcrumbs">üìö Life OS Docs</div>
            <button class="theme-btn" id="themeBtn">üåô Dark</button>
        </div>
        
        <div class="content" id="content">
            <div class="welcome">
                <h1>üìö Life OS Documentation</h1>
                <p>Select a file from the sidebar to view its contents.<br>
                All 196 markdown files organized in folders.</p>
                <p style="margin-top: 30px; color: #666;">üîç Type to search | ‚å®Ô∏è Arrow keys to navigate | ‚Üµ Enter to open</p>
            </div>
        </div>
    </main>

    <script>
        let files = [];
        let fileTree = {};
        
        async function init() {
            try {
                // Load index
                const res = await 'search-index.json');
                const data = await res.json();
                files = data.files || [];
                
                // Build tree
                fileTree = buildTree(files);
                renderTree(fileTree, '');
                
                console.log('‚úì Loaded ' + files.length + ' files');
            } catch (e) {
                document.getElementById('fileTree').innerHTML = 
                    '<div class="loading" style="color: #f55;">Error: ' + e.message + '</div>';
            }
        }
        
        function buildTree(fileList) {
            const tree = {};
            
            fileList.forEach(file => {
                const parts = file.path.split('/');
                let current = tree;
                
                parts.forEach((part, i) => {
                    if (!current[part]) {
                        current[part] = {
                            name: part,
                            type: i === parts.length - 1 ? 'file' : 'folder',
                            path: file.path,
                            children: {}
                        };
                    }
                    current = current[part].children;
                });
            });
            
            return tree;
        }
        
        function renderTree(nodes, pathPrefix) {
            const container = document.getElementById('fileTree');
            container.innerHTML = '';
            
            const keys = Object.keys(nodes).sort((a, b) => {
                const aNode = nodes[a];
                const bNode = nodes[b];
                if (aNode.type !== bNode.type) return aNode.type === 'folder' ? -1 : 1;
                return a.localeCompare(b);
            });
            
            keys.forEach(key => {
                const node = nodes[key];
                const div = document.createElement('div');
                div.className = 'tree-item ' + node.type;
                div.innerHTML = '<span style="margin-right: 6px;">' + 
                    (node.type === 'folder' ? 'üìÅ' : 'üìÑ') + '</span>' + node.name;
                
                div.onclick = () => {
                    if (node.type === 'folder') {
                        renderTree(node.children, node.path);
                    } else {
                        loadFile(node.path);
                    }
                };
                
                container.appendChild(div);
            });
        }
        
        async function loadFile(path) {
            document.getElementById('content').innerHTML = '<div class="loading">Loading ' + 'markdown/' + path + '...</div>';
            document.getElementById('breadcrumbs').textContent = 'üìö ' + 'markdown/' + path;
            
            try {
                const res = await fetch(path);
                if (!res.ok) throw new Error('File not found');
                const content = await res.text();
                
                // Convert markdown to HTML
                const html = convertMarkdown(content);
                document.getElementById('content').innerHTML = html;
                
                // Add to recent
                addToRecent(path);
            } catch (e) {
                document.getElementById('content').innerHTML = '<h2 style="color: #f55;">Error loading ' + 'markdown/' + path + '</h2><p style="color: #888;">' + e.message + '</p>';
            }
        }
        
        function convertMarkdown(text) {
            let html = '<div class="document">';
            const lines = text.split('\n');
            let inCodeBlock = false;
            let codeContent = [];
            
            lines.forEach(line => {
                // Code blocks
                if (line.startsWith('```')) {
                    if (inCodeBlock) {
                        html += '<pre><code>' + codeContent.join('\n') + '</code></pre>';
                        codeContent = [];
                    }
                    inCodeBlock = !inCodeBlock;
                    return;
                }
                
                if (inCodeBlock) {
                    codeContent.push(escapeHtml(line));
                    return;
                }
                
                // Headers
                if (line.startsWith('#### ')) {
                    html += '<h4>' + escapeHtml(line.substring(6)) + '</h4>';
                } else if (line.startsWith('### ')) {
                    html += '<h3>' + escapeHtml(line.substring(4)) + '</h3>';
                } else if (line.startsWith('## ')) {
                    html += '<h2>' + escapeHtml(line.substring(3)) + '</h2>';
                } else if (line.startsWith('# ')) {
                    html += '<h1>' + escapeHtml(line.substring(2)) + '</h1>';
                }
                // Horizontal rule
                else if (line.startsWith('---')) {
                    html += '<hr>';
                }
                // Blockquote
                else if (line.startsWith('> ')) {
                    html += '<blockquote>' + escapeHtml(line.substring(2)) + '</blockquote>';
                }
                // Unordered list
                else if (line.startsWith('- ') || line.startsWith('* ')) {
                    html += '<ul><li>' + escapeHtml(line.substring(2)) + '</li></ul>';
                }
                // Ordered list
                else if (/^\d+\.\s/.test(line)) {
                    html += '<ol><li>' + escapeHtml(line.replace(/^\d+\.\s/, '')) + '</li></ol>';
                }
                // Tables
                else if (line.startsWith('|')) {
                    html += '<p style="color: #666; font-size: 12px;">[Table: ' + line.substring(1, 50) + '...]</p>';
                }
                // Links
                else if (line.includes('[') && line.includes('](')) {
                    const textMatch = line.match(/\[([^\]]+)\]\(([^)]+)\)/);
                    if (textMatch) {
                        html += '<p><a href="' + textMatch[2] + '" target="_blank">' + escapeHtml(textMatch[1]) + '</a></p>';
                    }
                }
                // Regular paragraphs
                else if (line.trim()) {
                    // Bold, italic, inline code
                    let processed = escapeHtml(line);
                    processed = processed.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
                    processed = processed.replace(/\*([^*]+)\*/g, '<em>$1</em>');
                    processed = processed.replace(/`([^`]+)`/g, '<code>$1</code>');
                    html += '<p>' + processed + '</p>';
                }
            });
            
            html += '</div>';
            return html;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Recent files
        let recent = [];
        function addToRecent(path) {
            recent = recent.filter(p => p !== path);
            recent.unshift(path);
            recent = recent.slice(0, 10);
            localStorage.setItem('docs-recent', JSON.stringify(recent));
            renderRecent();
        }
        
        function renderRecent() {
            const container = document.getElementById('recentList');
            if (recent.length === 0) {
                container.innerHTML = '<div style="color: #666; font-size: 13px;">No recent files</div>';
                return;
            }
            
            container.innerHTML = '';
            recent.forEach(path => {
                const div = document.createElement('div');
                div.className = 'tree-item file';
                div.style.paddingLeft = '35px';
                div.innerHTML = 'üìÑ ' + 'markdown/' + path;
                div.onclick = () => loadFile(path);
                container.appendChild(div);
            });
        }
        
        // Search
        document.getElementById('search').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            if (!query) {
                renderTree(fileTree, '');
                return;
            }
            
            const results = files.filter(f => 
                f.title.toLowerCase().includes(query) || 
                f.path.toLowerCase().includes(query)
            );
            
            const container = document.getElementById('fileTree');
            container.innerHTML = '';
            
            if (results.length === 0) {
                container.innerHTML = '<div style="padding: 20px; color: #666;">No files found</div>';
                return;
            }
            
            results.forEach(file => {
                const div = document.createElement('div');
                div.className = 'tree-item file';
                div.style.paddingLeft = '35px';
                div.innerHTML = 'üìÑ ' + file.path;
                div.onclick = () => loadFile(file.path);
                container.appendChild(div);
            });
        });
        
        // Theme toggle
        let dark = true;
        document.getElementById('themeBtn').onclick = () => {
            dark = !dark;
            document.body.style.background = dark ? '#0a0a0f' : '#ffffff';
            document.body.style.color = dark ? '#e0e0e0' : '#1a1a1a';
            document.getElementById('themeBtn').textContent = dark ? 'üåô Dark' : '‚òÄÔ∏è Light';
        };
        
        // Load recent from storage
        try {
            recent = JSON.parse(localStorage.getItem('docs-recent') || '[]');
            renderRecent();
        } catch (e) {}
        
        init();
    </script>
</body>
</html>
